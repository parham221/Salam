<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø±Ù…Ø²Ú¯Ø°Ø§Ø± ÙØ§Ø±Ø³ÛŒ Ù¾Ø±Ù‡Ø§Ù…</title>

  <!-- Progressive Web App Meta Tags -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#333333" />
  <meta name="description" content="Ø§Ø¨Ø²Ø§Ø± Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ Ø¨Ø§ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø¨ÛŒÙˆÙ…ØªØ±ÛŒÚ©ØŒ QRØŒ ØµÙˆØª Ùˆ ØªØ§Ø±ÛŒØ®Ú†Ù‡" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="CryptoParham" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="icon" href="icons/icon-192.png" />

  <style>
    /* Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø±ÛŒØ´Ù‡ */
    :root {
      --bg-light: #f0f0f0;
      --bg-dark:  #333333;
      --text-light: #ffffff;
      --text-dark:  #000000;
      --primary-color: #333333;
      --accent-color: #ff4081;
    }

    /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0; padding: 0;
    }

    body {
      font-family: sans-serif;
      background: var(--bg-light);
      color: var(--text-dark);
      min-height: 100vh;
      display: flex; flex-direction: column;
      transition: background .3s, color .3s;
    }
    body.dark {
      background: var(--bg-dark);
      color: var(--text-light);
    }

    header {
      background: var(--primary-color);
      color: var(--text-light);
      padding: 1rem;
      text-align: center;
    }

    main {
      flex: 1;
      padding: 1rem;
    }

    .hidden {
      display: none !important;
    }

    #hamburgerBtn {
      font-size: 1.5rem;
      cursor: pointer;
      margin: .5rem;
    }

    #mobileNav {
      display: none;
      background: #dddddd;
      padding: .5rem;
      margin-bottom: 1rem;
    }
    #mobileNav.open {
      display: block;
    }

    button {
      padding: .5rem 1rem;
      margin: .25rem;
      font-size: 1rem;
      cursor: pointer;
      background: var(--accent-color);
      border: none;
      color: var(--text-light);
      border-radius: .25rem;
    }
    button:hover {
      background: #e73370;
    }

    input, textarea {
      width: 100%; max-width: 400px;
      padding: .5rem;
      margin: .5rem auto;
      font-size: 1rem;
      display: block;
      border: 1px solid #ccc;
      border-radius: .25rem;
    }
    textarea { resize: vertical; }

    .section {
      margin: 1rem auto;
      max-width: 400px;
      text-align: center;
    }

    ul { list-style: none; padding: 0; }
    ul li {
      padding: .25rem 0;
      border-bottom: 1px solid #ccc;
      text-align: left;
      word-break: break-all;
    }
  </style>
</head>
<body>

  <header>
    <h1>ğŸ” Ø±Ù…Ø²Ú¯Ø°Ø§Ø± ÙØ§Ø±Ø³ÛŒ Ù¾Ø±Ù‡Ø§Ù…</h1>
  </header>

  <main>
    <!-- Ø¨Ø®Ø´ ÙˆØ±ÙˆØ¯ -->
    <section id="loginSection" class="section">
      <input type="password" id="passwordInput" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" />
      <button id="loginBtn">ÙˆØ±ÙˆØ¯</button>
      <button id="enableBioBtn">ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨ÛŒÙˆÙ…ØªØ±ÛŒÚ©</button>
      <button id="bioLoginBtn">ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø§Ø«Ø± Ø§Ù†Ú¯Ø´Øª</button>
    </section>

    <!-- Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ Ù¾Ø³ Ø§Ø² ÙˆØ±ÙˆØ¯ -->
    <section id="appSection" class="hidden">
      <div id="hamburgerBtn" aria-label="Ø¨Ø§Ø²/Ø¨Ø³ØªÙ† Ù…Ù†Ùˆ">â˜° Ù…Ù†Ùˆ</div>
      <nav id="mobileNav" aria-hidden="true">
        <button data-section="encodeSection">Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ</button>
        <button data-section="decodeSection">Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ</button>
        <button data-section="settingsSection">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
        <button data-section="historySection">ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
      </nav>

      <!-- Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ -->
      <section id="encodeSection" class="section hidden">
        <h2>âœï¸ Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ Ù…ØªÙ†</h2>
        <textarea id="encodeInput" rows="4" placeholder="Ù…ØªÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"></textarea>
        <button id="encodeBtn">Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ</button>
        <p id="encodeResult" aria-live="polite"></p>
      </section>

      <!-- Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ -->
      <section id="decodeSection" class="section hidden">
        <h2>ğŸ”“ Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ Ù…ØªÙ†</h2>
        <textarea id="decodeInput" rows="4" placeholder="Ù…ØªÙ† Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡"></textarea>
        <button id="decodeBtn">Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ</button>
        <p id="decodeResult" aria-live="polite"></p>
      </section>

      <!-- ØªÙ†Ø¸ÛŒÙ…Ø§Øª -->
      <section id="settingsSection" class="section hidden">
        <h2>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
        <button id="darkModeBtn">ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©</button>
        <button id="qrBtn">Ø³Ø§Ø®Øª QR</button>
        <button id="soundBtn">Ù¾Ø®Ø´ ØµÙˆØª</button>
      </section>

      <!-- ØªØ§Ø±ÛŒØ®Ú†Ù‡ -->
      <section id="historySection" class="section hidden">
        <h2>ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡</h2>
        <ul id="historyList"></ul>
        <button id="clearHistoryBtn">Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡</button>
      </section>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let logged = false;
      let historyList = JSON.parse(localStorage.getItem('cryptoHistory') || '[]');

      // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´â€ŒÙ‡Ø§
      function showSection(sectionId) {
        const all = [
          'loginSection','appSection',
          'encodeSection','decodeSection',
          'settingsSection','historySection'
        ];
        all.forEach(id => {
          document.getElementById(id)
            .classList.toggle('hidden', id !== sectionId);
        });
        if (['encodeSection','decodeSection','settingsSection','historySection']
            .includes(sectionId)) {
          document.getElementById('appSection')
            .classList.remove('hidden');
        }
      }

      // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡
      function updateHistory() {
        const ul = document.getElementById('historyList');
        ul.innerHTML = '';
        historyList.slice(-10).reverse().forEach(item => {
          const li = document.createElement('li');
          li.textContent = item;
          ul.appendChild(li);
        });
        localStorage.setItem('cryptoHistory', JSON.stringify(historyList));
      }
      updateHistory();

      // ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø±Ù…Ø²
      document.getElementById('loginBtn').onclick = () => {
        const pw = document.getElementById('passwordInput').value;
        if (pw === 'parham123') {
          logged = true;
          showSection('encodeSection');
        } else {
          alert('Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
        }
      };

      // Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¨ÛŒÙˆÙ…ØªØ±ÛŒÚ©
      const supportsWebAuthn = (
        window.PublicKeyCredential &&
        typeof window.PublicKeyCredential === 'function'
      );

      document.getElementById('enableBioBtn').onclick = async () => {
        if (!supportsWebAuthn) {
          return alert('Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ø¨ÛŒÙˆÙ…ØªØ±ÛŒÚ© Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯');
        }
        try {
          await navigator.credentials.create({ publicKey: {
            challenge: new Uint8Array(32),
            rp: { name: 'Parham Crypto' },
            user: { id: new Uint8Array(16), name: 'parham', displayName: 'Parham' },
            pubKeyCredParams: [{ type:'public-key', alg:-7 }],
            authenticatorSelection: { authenticatorAttachment:'platform' },
            timeout:60000, attestation:'none'
          }});
          alert('Ø¨ÛŒÙˆÙ…ØªØ±ÛŒÚ© ÙØ¹Ø§Ù„ Ø´Ø¯');
        } catch (err) {
          alert('Ø®Ø·Ø§ Ø¯Ø± ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨ÛŒÙˆÙ…ØªØ±ÛŒÚ©: ' + err.message);
        }
      };

      document.getElementById('bioLoginBtn').onclick = async () => {
        if (!supportsWebAuthn) {
          return alert('Ø¨ÛŒÙˆÙ…ØªØ±ÛŒÚ© Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª');
        }
        try {
          await navigator.credentials.get({ publicKey: {
            challenge: new Uint8Array(32),
            timeout:60000, userVerification:'required'
          }});
          logged = true;
          showSection('encodeSection');
        } catch (err) {
          alert('ÙˆØ±ÙˆØ¯ Ø¨ÛŒÙˆÙ…ØªØ±ÛŒÚ© Ù†Ø§Ù…ÙˆÙÙ‚: ' + err.message);
        }
      };

      // Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ
      document.getElementById('hamburgerBtn').onclick = () => {
        document.getElementById('mobileNav').classList.toggle('open');
      };

      // Ù†Ø§ÙˆØ¨Ø±ÛŒ
      document.querySelectorAll('#mobileNav button').forEach(btn => {
        btn.onclick = () => showSection(btn.dataset.section);
      });

      // TextEncoder / TextDecoder
      const encoder = new TextEncoder();
      const decoder = new TextDecoder();

      // Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ
      document.getElementById('encodeBtn').onclick = () => {
        const txt = document.getElementById('encodeInput').value;
        const bytes = encoder.encode(txt);
        const enc = btoa(String.fromCharCode(...bytes));
        document.getElementById('encodeResult').textContent = enc;
        historyList.push('ğŸ” ' + enc);
        updateHistory();
      };

      // Ø±Ù…Ø²Ú¯Ø´Ø§ÛŒÛŒ
      document.getElementById('decodeBtn').onclick = () => {
        const enc = document.getElementById('decodeInput').value;
        try {
          const str = atob(enc);
          const arr = Uint8Array.from(str, c => c.charCodeAt(0));
          const dec = decoder.decode(arr);
          document.getElementById('decodeResult').textContent = dec;
          historyList.push('ğŸ”“ ' + dec);
          updateHistory();
        } catch {
          document.getElementById('decodeResult').textContent = 'Ù…ØªÙ† Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª';
        }
      };

      // Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©
      document.getElementById('darkModeBtn').onclick = () => {
        document.body.classList.toggle('dark');
      };

      // Ø³Ø§Ø®Øª QR
      document.getElementById('qrBtn').onclick = () => {
        const data = document.getElementById('encodeResult').textContent;
        if (!data) return alert('Ù…ØªÙ†ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª QR Ù†ÛŒØ³Øª');
        window.open(
          `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(data)}&size=150x150`,
          '_blank'
        );
      };

      // Ù¾Ø®Ø´ ØµÙˆØª
      document.getElementById('soundBtn').onclick = () => {
        new Audio(
          'https://cdn.pixabay.com/download/audio/2022/03/15/audio_7c3b1b7b6e.mp3?filename=click-124467.mp3'
        ).play();
      };

      // Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡
      document.getElementById('clearHistoryBtn').onclick = () => {
        historyList = [];
        updateHistory();
      };

      // Ø«Ø¨Øª Service Worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js')
          .catch(err => console.warn('Service Worker failed:', err));
      }
    });
  </script>
</body>
</html>